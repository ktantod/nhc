<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Risk Estimate Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .risk-block {
            background-color: #fff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }
        .risk-block h2 {
            margin-top: 0;
        }
        .risk-block ul {
            list-style: none;
            padding-left: 0;
        }
        .risk-block ul li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

<h1>Risk Estimate Results</h1>
<div id="results">Loading...</div>

<script>
// Helper to get URL parameter
function getURLParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

function formatPercent(value) {
    return (value * 100).toFixed(1) + '%';
}

function formatRiskBlock(title, data) {
    return `
        <div class="risk-block">
            <h2>${title}</h2>
            <ul>
                <li><strong>Model:</strong> ${data.model}</li>
                <li><strong>Input Problem:</strong> ${data.input_problem === null ? 'None' : data.input_problem}</li>
                <li><strong>Total CVD Risk:</strong> ${formatPercent(data.total_cvd)}</li>
                <li><strong>ASCVD Risk:</strong> ${formatPercent(data.ascvd)}</li>
                <li><strong>Heart Failure Risk:</strong> ${formatPercent(data.heart_failure)}</li>
                <li><strong>CHD Risk:</strong> ${formatPercent(data.chd)}</li>
                <li><strong>Stroke Risk:</strong> ${formatPercent(data.stroke)}</li>
                <li><strong>Over Years:</strong> ${data.over_years} years</li>
            </ul>
        </div>
    `;
}

const riskJsonParam = getURLParameter('riskjson');

if (riskJsonParam) {
    try {
        const decodedJson = decodeURIComponent(riskJsonParam);
        const parsedJson = JSON.parse(decodedJson);

        let html = '';
        if (parsedJson.risk_est_10yr) {
            html += formatRiskBlock('10 Year Risk Estimate', parsedJson.risk_est_10yr);
        }
        if (parsedJson.risk_est_30yr) {
            html += formatRiskBlock('30 Year Risk Estimate', parsedJson.risk_est_30yr);
        }

        document.getElementById('results').innerHTML = html;

    } catch (e) {
        document.getElementById('results').textContent = 'Invalid JSON data.';
    }
} else {
    document.getElementById('results').textContent = 'No riskjson parameter found in URL.';
}
</script>

</body>
</html>
